{% extends "layouts/base.html" %}
{% load static %}

{% block title %} Sign UP Cover {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
    <style>
        .process {
            width: 100%;
            height: 5px;
            background-color: #f5f5f5;
        }

        .process-val {
            height: 100%;
            width: 20%;
            background-color: red;
        }

        /* Custom checkbox styling for terms and conditions */
        .form-check-input[type="checkbox"]:not(:checked) {
            background-color: #fff !important;
            border-color: #dc3545 !important; /* Red border */
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='%23dc3545' d='M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z'/%3e%3c/svg%3e") !important; /* Red X SVG */
        }

        .form-check-input[type="checkbox"]:checked {
            background-color: #28a745 !important; /* Green background */
            border-color: #28a745 !important; /* Green border */
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 20 20'%3e%3cpath fill='none' stroke='%23fff' stroke-linecap='round' stroke-linejoin='round' stroke-width='3' d='M6 10l3 3l6-6'/%3e%3c/svg%3e") !important; /* White Checkmark SVG */
        }

        .form-check-input[type="checkbox"]:focus {
            box-shadow: 0 0 0 0.25rem rgba(40, 167, 69, 0.25) !important; /* Greenish shadow */
            border-color: #28a745 !important; /* Consistent focus border color */
        }
    </style>
{% endblock %}

{% block body_class %} sign-up-cover {% endblock %}

{% block content %}

  {% include 'includes/navigation.html' %}

  <header class="header-2">
    <div class="page-header min-vh-75 relative" style="background-image:url('{% static 'assets/img/added-images/analytics.png' %}')">
      <span class="mask bg-gradient-dark"></span>
      <div class="container">
        <div class="row">
          <div class="col-xl-8 col-lg-10 col-md-11 mx-auto">
            <div class="card mt-8 bg-white shadow-lg">
              <div class="card-header pb-0 text-left">
                <h3 class="font-weight-bolder text-primary text-gradient">Join us today</h3>
                <p class="mb-0">
                    {% if msg %}
                      <span class="text-danger">{{ msg | safe }}</span>
                    {% else %}
                        Add your credentials
                    {% endif %}
                </p>
              </div>

              {% if success %}

                <div class="card-body pb-3">

                  <div class="text-center">
                    <a href="{% url 'login' %}"
                       class="btn bg-gradient-primary w-100 mt-4 mb-0">Sign IN</a>
                  </div>

                </div>

              {% else %}

                <div class="card-body pb-3">

                  <form method="post" action="">

                    {% csrf_token %}

                    <label>Username</label>
                    <div class="mb-3">
                      {{ form.username }}
                    </div>
                    <span class="text-danger">{{ form.username.errors }}</span>

                    <label>Email</label>
                    <div class="mb-3">
                      {{ form.email }}
                    </div>
                    <span class="text-danger">{{ form.email.errors }}</span>

                    <label>First Name</label>
                    <div class="mb-3">
                      {{ form.first_name }}
                    </div>
                    <span class="text-danger">{{ form.first_name.errors }}</span>

                    <label>Last Name</label>
                    <div class="mb-3">
                      {{ form.last_name }}
                    </div>
                    <span class="text-danger">{{ form.last_name.errors }}</span>

                    <label>Password</label>
                    <div class="input-group input-group-outline">
                      {{ form.password1 }}
                        <button class="mb-0 btn btn-outline-primary show-pass-btn" type="button" >
                            <i class="m-0 fa fa-eye"></i></button>
                    </div>
                      <div class="process d-none rounded-1">
                        <div class="process-val rounded-1"></div>
                    </div>
                   <div class="mb-3"></div>
                    <span class="text-danger">{{ form.password1.errors }}</span>

                    <label>Password Confirmation</label>
                    <div class="mb-3 input-group input-group-outline">
                      {{ form.password2 }}
                        <button class="mb-0 btn btn-outline-primary copy-pass-btn" type="button">
                            <i class="fa fa-copy m-0"></i></button>
                    </div>
                    <span class="text-danger">{{ form.password2.errors }}</span>

                    <div class="form-check text-left"> {# Removed form-check-info here #}
                      <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"> {# Removed 'checked' attribute #}
                      <label class="form-check-label" for="flexCheckDefault">
                        I agree the <a href="#" class="text-dark font-weight-bolder">Terms and Conditions</a>
                      </label>
                    </div>

                    <div class="text-center">
                      <button type="submit" name="register" class="btn bg-gradient-primary w-100 mt-4 mb-0">Sign UP</button>
                    </div>

                  </form>
                </div>
                <div class="card-footer text-center pt-0 px-sm-4 px-1">
                  <p class="mb-4 mx-auto">
                    Already have an account?
                    <a href="{% url 'login' %}" class="text-primary text-gradient font-weight-bold">Sign IN</a>
                  </p>
                </div>

              {% endif %}

            </div>
          </div>
        </div>
      </div>
      <div class="position-absolute w-100 z-index-1 bottom-0">
        <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 40" preserveAspectRatio="none" shape-rendering="auto">
          <defs>
            <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
          </defs>
          <g class="moving-waves">
            <use xlink:href="#gentle-wave" x="48" y="-1" fill="rgba(255,255,255,0.40" />
            <use xlink:href="#gentle-wave" x="48" y="3" fill="rgba(255,255,255,0.35)" />
            <use xlink:href="#gentle-wave" x="48" y="5" fill="rgba(255,255,255,0.25)" />
            <use xlink:href="#gentle-wave" x="48" y="8" fill="rgba(255,255,255,0.20)" />
            <use xlink:href="#gentle-wave" x="48" y="13" fill="rgba(255,255,255,0.15)" />
            <use xlink:href="#gentle-wave" x="48" y="16" fill="rgba(255,255,255,0.95" />
          </g>
        </svg>
      </div>
    </div>
  </header>

  {% include 'includes/footer-5.html' %}

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
    <script>
    const visibleProcessBar = (b) => {
            b ?
                document.querySelector('.process').classList.remove('d-none')
            :
                document.querySelector('.process').classList.add('d-none')
        }

        let isHidden = true
        document.querySelector('.show-pass-btn').addEventListener('click' , (e) => {
            const pass1 = document.querySelector('#id_password1')

            const type = isHidden ? 'text' : 'password';
            isHidden = !isHidden
            pass1.setAttribute('type',type)

            const pass2 = document.querySelector('#id_password2')
            pass2.setAttribute('type',type)

            document.querySelector('.show-pass-btn i').className = isHidden ? "m-0 fa fa-eye" : "m-0 fa fa-eye-slash"
        })

        document.querySelector('.copy-pass-btn').addEventListener('mouseup' , (e) => {
            document.querySelector('#id_password2').value = document.querySelector('#id_password1').value

        })

        const changeProcessBarStatus = (s) => {
            const processBar = document.querySelector('.process-val')

            if (s <= 40)
                processBar.style.backgroundColor = 'red'
            else if (s <= 60)
                processBar.style.backgroundColor = 'orange'
            else if (s <= 80)
                processBar.style.backgroundColor = 'yellow'
            else if (s <= 100)
                processBar.style.backgroundColor = 'green'

            processBar.style.width = (s === 0 ? 10 : s) + '%'
        }


        const passReg = []
        passReg.push(/(?=.*[A-Z].*[A-Z])/)
        passReg.push(/(?=.*[!@#$&*])/)
        passReg.push(/(?=.*[0-9].*[0-9])/)
        passReg.push(/(?=.*[a-z].*[a-z].*[a-z])/)
        passReg.push(/.{8}/)

        window.onload = function () {
            document.getElementById('id_password1').onkeyup = (e) => {
                if (e.target.value.length !== 0)
                    visibleProcessBar(true)
                else
                    visibleProcessBar(false)

                let count = 0
                for (let i = 0; i < passReg.length; i++) {
                    if (new RegExp(passReg[i]).test(e.target.value) )
                        count += 1
                }

                changeProcessBarStatus(count * 100 / 5 )
            }
        }
    </script>
{% endblock %}
